# 로그 분석 시스템 테이블 정의서

## 1. log_analysis (로그 분석 테이블)

| 테이블(한글명) | 테이블(영문명) | 컬럼(한글명) | 컬럼(영문명) | 컬럼설명 | 타입 | PK | FK | NULL | 자동생성 | Default |
|----------------|----------------|--------------|--------------|----------|------|----|----|------|----------|---------|
| 로그 분석 | log_analysis | 아이디 | id | 고유번호 | INT(11) | YES | | NO | AUTO_INCREMENT | |
| 로그 분석 | log_analysis | 로그 발생 시간 | log_date | 로그 발생 시간 | DATETIME | | | NO | | |
| 로그 분석 | log_analysis | 오류 레벨 | error_level | 오류 레벨 (CRITICAL, ERROR, WARNING, INFO) | VARCHAR(20) | | | NO | | |
| 로그 분석 | log_analysis | 오류 메시지 | error_message | 오류 메시지 | TEXT | | | NO | | |
| 로그 분석 | log_analysis | 파일 경로 | file_path | 오류 발생 파일 경로 | VARCHAR(500) | | | YES | | NULL |
| 로그 분석 | log_analysis | 라인 번호 | line_number | 오류 발생 라인 번호 | INT | | | YES | | NULL |
| 로그 분석 | log_analysis | 스택 트레이스 | stack_trace | 스택 트레이스 | TEXT | | | YES | | NULL |
| 로그 분석 | log_analysis | 사용자 아이디 | user_id | 사용자 ID | VARCHAR(50) | | | YES | | NULL |
| 로그 분석 | log_analysis | 사용자 이름 | user_name | 사용자 이름 | VARCHAR(100) | | | YES | | NULL |
| 로그 분석 | log_analysis | 회사 코드 | company_cd | 회사 코드 | VARCHAR(20) | | | YES | | NULL |
| 로그 분석 | log_analysis | 지점 코드 | branch_cd | 지점 코드 | VARCHAR(20) | | | YES | | NULL |
| 로그 분석 | log_analysis | 요청 URL | request_url | 요청 URL | VARCHAR(500) | | | YES | | NULL |
| 로그 분석 | log_analysis | 요청 메서드 | request_method | 요청 메서드 (GET, POST 등) | VARCHAR(10) | | | YES | | NULL |
| 로그 분석 | log_analysis | 요청 파라미터 | request_params | 요청 파라미터 | TEXT | | | YES | | NULL |
| 로그 분석 | log_analysis | 세션 데이터 | session_data | 세션 데이터 | TEXT | | | YES | | NULL |
| 로그 분석 | log_analysis | 사용자 에이전트 | user_agent | 사용자 에이전트 | VARCHAR(500) | | | YES | | NULL |
| 로그 분석 | log_analysis | IP 주소 | ip_address | IP 주소 | VARCHAR(50) | | | YES | | NULL |
| 로그 분석 | log_analysis | 오류 해시 | error_hash | 오류 고유 해시 (중복 체크용) | VARCHAR(64) | | | YES | | NULL |
| 로그 분석 | log_analysis | 발생 횟수 | occurrence_count | 발생 횟수 | INT | | | NO | | 1 |
| 로그 분석 | log_analysis | 최초 발생 시간 | first_occurred | 최초 발생 시간 | DATETIME | | | YES | | NULL |
| 로그 분석 | log_analysis | 최근 발생 시간 | last_occurred | 최근 발생 시간 | DATETIME | | | YES | | NULL |
| 로그 분석 | log_analysis | 해결 여부 | is_resolved | 해결 여부 | BOOLEAN | | | NO | | FALSE |
| 로그 분석 | log_analysis | 해결한 사용자 | resolved_by | 해결한 사용자 | VARCHAR(50) | | | YES | | NULL |
| 로그 분석 | log_analysis | 해결 시간 | resolved_at | 해결 시간 | DATETIME | | | YES | | NULL |
| 로그 분석 | log_analysis | 적용된 수정 사항 | fix_applied | 적용된 수정 사항 | TEXT | | | YES | | NULL |
| 로그 분석 | log_analysis | 생성일시 | created_at | 생성일시 | TIMESTAMP | | | YES | | CURRENT_TIMESTAMP |
| 로그 분석 | log_analysis | 수정일시 | updated_at | 수정일시 | TIMESTAMP | | | YES | | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP |

### 인덱스
- PRIMARY KEY: id
- INDEX: log_date, error_level, user_id, error_hash, (company_cd, branch_cd), is_resolved

---

## 2. error_fix_history (오류 수정 이력 테이블)

| 테이블(한글명) | 테이블(영문명) | 컬럼(한글명) | 컬럼(영문명) | 컬럼설명 | 타입 | PK | FK | NULL | 자동생성 | Default |
|----------------|----------------|--------------|--------------|----------|------|----|----|------|----------|---------|
| 오류 수정 이력 | error_fix_history | 아이디 | id | 고유번호 | INT(11) | YES | | NO | AUTO_INCREMENT | |
| 오류 수정 이력 | error_fix_history | 오류 아이디 | error_id | 관련 오류 ID | INT | | YES | NO | | |
| 오류 수정 이력 | error_fix_history | 수정한 사용자 | fixed_by | 수정한 사용자 | VARCHAR(50) | | | NO | | |
| 오류 수정 이력 | error_fix_history | 수정 시간 | fixed_at | 수정 시간 | DATETIME | | | NO | | |
| 오류 수정 이력 | error_fix_history | 파일 경로 | file_path | 수정한 파일 경로 | VARCHAR(500) | | | NO | | |
| 오류 수정 이력 | error_fix_history | 원본 코드 | original_code | 원본 코드 | TEXT | | | YES | | NULL |
| 오류 수정 이력 | error_fix_history | 수정된 코드 | fixed_code | 수정된 코드 | TEXT | | | YES | | NULL |
| 오류 수정 이력 | error_fix_history | 수정 설명 | fix_description | 수정 설명 | TEXT | | | YES | | NULL |
| 오류 수정 이력 | error_fix_history | 수정 유형 | fix_type | 수정 유형 (AI, TEMPLATE, MANUAL) | VARCHAR(50) | | | YES | | NULL |
| 오류 수정 이력 | error_fix_history | 생성일시 | created_at | 생성일시 | TIMESTAMP | | | YES | | CURRENT_TIMESTAMP |

### 인덱스
- PRIMARY KEY: id
- INDEX: error_id, fixed_by
- FOREIGN KEY: error_id REFERENCES log_analysis(id)

---

## 3. log_statistics_summary (로그 통계 요약 테이블)

| 테이블(한글명) | 테이블(영문명) | 컬럼(한글명) | 컬럼(영문명) | 컬럼설명 | 타입 | PK | FK | NULL | 자동생성 | Default |
|----------------|----------------|--------------|--------------|----------|------|----|----|------|----------|---------|
| 로그 통계 요약 | log_statistics_summary | 아이디 | id | 고유번호 | INT(11) | YES | | NO | AUTO_INCREMENT | |
| 로그 통계 요약 | log_statistics_summary | 날짜 | date | 통계 날짜 | DATE | | | NO | | |
| 로그 통계 요약 | log_statistics_summary | 오류 레벨 | error_level | 오류 레벨 | VARCHAR(20) | | | NO | | |
| 로그 통계 요약 | log_statistics_summary | 발생 횟수 | count | 발생 횟수 | INT | | | NO | | 0 |
| 로그 통계 요약 | log_statistics_summary | 고유 오류 수 | unique_errors | 고유 오류 수 | INT | | | NO | | 0 |
| 로그 통계 요약 | log_statistics_summary | 영향받은 사용자 수 | affected_users | 영향받은 사용자 수 | INT | | | NO | | 0 |
| 로그 통계 요약 | log_statistics_summary | 해결된 오류 수 | resolved_count | 해결된 오류 수 | INT | | | NO | | 0 |
| 로그 통계 요약 | log_statistics_summary | 생성일시 | created_at | 생성일시 | TIMESTAMP | | | YES | | CURRENT_TIMESTAMP |

### 인덱스
- PRIMARY KEY: id
- UNIQUE INDEX: (date, error_level)

---

## 4. log_alert_settings (로그 알림 설정 테이블)

| 테이블(한글명) | 테이블(영문명) | 컬럼(한글명) | 컬럼(영문명) | 컬럼설명 | 타입 | PK | FK | NULL | 자동생성 | Default |
|----------------|----------------|--------------|--------------|----------|------|----|----|------|----------|---------|
| 로그 알림 설정 | log_alert_settings | 아이디 | id | 고유번호 | INT(11) | YES | | NO | AUTO_INCREMENT | |
| 로그 알림 설정 | log_alert_settings | 알림 이름 | alert_name | 알림 이름 | VARCHAR(100) | | | NO | | |
| 로그 알림 설정 | log_alert_settings | 오류 레벨 | error_level | 모니터링할 오류 레벨 | VARCHAR(20) | | | NO | | |
| 로그 알림 설정 | log_alert_settings | 임계값 | threshold_count | 임계값 (이상 발생시 알림) | INT | | | NO | | 1 |
| 로그 알림 설정 | log_alert_settings | 시간 윈도우 | time_window | 시간 윈도우 (분) | INT | | | NO | | 60 |
| 로그 알림 설정 | log_alert_settings | 알림 이메일 | alert_email | 알림 이메일 | VARCHAR(255) | | | YES | | NULL |
| 로그 알림 설정 | log_alert_settings | 알림 SMS | alert_sms | 알림 SMS 번호 | VARCHAR(20) | | | YES | | NULL |
| 로그 알림 설정 | log_alert_settings | 활성화 여부 | is_active | 활성화 여부 | BOOLEAN | | | NO | | TRUE |
| 로그 알림 설정 | log_alert_settings | 생성자 | created_by | 생성자 | VARCHAR(50) | | | YES | | NULL |
| 로그 알림 설정 | log_alert_settings | 생성일시 | created_at | 생성일시 | TIMESTAMP | | | YES | | CURRENT_TIMESTAMP |
| 로그 알림 설정 | log_alert_settings | 수정일시 | updated_at | 수정일시 | TIMESTAMP | | | YES | | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP |

### 인덱스
- PRIMARY KEY: id
- INDEX: error_level

---

## 테이블 관계도

```
log_analysis (1) ──────< (N) error_fix_history
     │
     │
     └──── 통계 집계 ────> log_statistics_summary
     
log_alert_settings (독립 테이블)
```

## 주요 특징

1. **log_analysis**: 모든 로그 정보를 저장하는 메인 테이블
2. **error_fix_history**: 오류 수정 이력을 추적하는 테이블 (log_analysis.id를 참조)
3. **log_statistics_summary**: 일별 통계를 미리 계산하여 저장하는 요약 테이블
4. **log_alert_settings**: 관리자가 설정한 알림 조건을 저장하는 테이블