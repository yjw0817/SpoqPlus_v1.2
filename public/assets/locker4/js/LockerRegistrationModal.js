var ze=Object.defineProperty;var Be=(r,t,e)=>t in r?ze(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var ue=(r,t,e)=>Be(r,typeof t!="symbol"?t+"":t,e);import{B as Ke,r as b,c as L,C as he,d as Te,b as C,e as S,k as q,j as oe,h as i,g as P,F as te,i as ve,t as j,p as Ne,_ as xe,q as G,v as W,s as Ve,z as Ye,m as He}from"./index.js";function U(){return typeof window<"u"&&window.LockerConfig?window.LockerConfig:null}function Ae(){return U()!==null}function Ge(){const r=U();return r?r.apiUrl:"/api"}function Xe(){const r=U();return(r==null?void 0:r.csrfToken)||""}function je(){const r=U();return(r==null?void 0:r.csrfHeader)||"X-CSRF-TOKEN"}function Fe(){const r=U();return{companyCode:(r==null?void 0:r.companyCode)||"001",officeCode:(r==null?void 0:r.officeCode)||"001"}}function Je(){const r=U();return(r==null?void 0:r.user)||{id:"",name:"",role:"",isLoggedIn:!1}}function qe(){var t;const r=U();return((t=r==null?void 0:r.features)==null?void 0:t.enableDebugMode)||!1}function We(){qe()&&(console.log("[Locker4] Configuration:",U()),console.log("[Locker4] Environment:",Ae()?"CodeIgniter":"Standalone"),console.log("[Locker4] API URL:",Ge()),console.log("[Locker4] User:",Je()))}typeof window<"u"&&window.addEventListener("DOMContentLoaded",()=>{We()});const Re={1:{width:40,height:40,depth:40},2:{width:50,height:60,depth:50},3:{width:60,height:80,depth:60}},Ie={1:"#3b82f6",2:"#10b981",3:"#f59e0b",4:"#8b5cf6",5:"#ef4444",6:"#14b8a6",7:"#f97316",8:"#6366f1"};class Ze{constructor(){ue(this,"baseUrl");ue(this,"headers");ue(this,"useCodeIgniter");if(this.useCodeIgniter=Ae(),this.useCodeIgniter){const t=U();this.baseUrl=t?t.baseUrl+"/api":"/api"}else this.baseUrl="http://localhost:3333/api";if(this.headers={"Content-Type":"application/json"},console.log("[LockerApi] Using API:",this.baseUrl),console.log("[LockerApi] CodeIgniter environment:",this.useCodeIgniter),this.useCodeIgniter){const t=Xe(),e=je();t&&e&&(this.headers[e]=t)}}dbToAppFormat(t){const e=String(t.LOCKR_TYPE_CD||"1"),c=Re[e]||Re[1]||{width:40,height:40,depth:40},p=Ie[e]||Ie[1];return{id:`locker-${t.LOCKR_CD}`,number:t.LOCKR_LABEL||"",x:t.X||0,y:t.Y||0,width:c.width||40,height:c.height||40,depth:c.depth||40,color:p,status:this.mapDbStatusToApp(t.LOCKR_STAT),rotation:t.ROTATION||0,zoneId:t.LOCKR_KND,typeId:t.LOCKR_TYPE_CD,lockrCd:t.LOCKR_CD,compCd:t.COMP_CD,bcoffCd:t.BCOFF_CD,lockrLabel:t.LOCKR_LABEL,lockrNo:t.LOCKR_NO,lockrKnd:t.LOCKR_KND,lockrTypeCd:t.LOCKR_TYPE_CD,doorDirection:t.DOOR_DIRECTION,groupNum:t.GROUP_NUM,lockrGendrSet:t.LOCKR_GENDR_SET,parentLockerId:(()=>{const k=t.PARENT_LOCKR_CD?`locker-${t.PARENT_LOCKR_CD}`:null;return t.LOCKR_LABEL&&t.LOCKR_LABEL.includes("-T"),k})(),parentLockrCd:t.PARENT_LOCKR_CD,childLockerIds:[],tierLevel:t.TIER_LEVEL||0,frontViewX:t.FRONT_VIEW_X,frontViewY:t.FRONT_VIEW_Y,frontViewNumber:t.LOCKR_NO?`${t.LOCKR_NO}`:void 0,memSno:t.MEM_SNO,memNm:t.MEM_NM,lockrUseSDate:t.LOCKR_USE_S_DATE,lockrUseEDate:t.LOCKR_USE_E_DATE,lockrStat:t.LOCKR_STAT,buyEventSno:t.BUY_EVENT_SNO,isVisible:!0,isAnimating:!1,hasError:!1,assignedTo:t.MEM_NM?{name:t.MEM_NM,expiryDate:t.LOCKR_USE_E_DATE?new Date(t.LOCKR_USE_E_DATE):new Date}:void 0,memo:t.MEMO,updateBy:t.UPDATE_BY,updateDt:t.UPDATE_DT}}appToDbFormat(t){const e=t.parentLockrCd||(t.parentLockerId?parseInt(t.parentLockerId.replace("locker-","")):null);return{LOCKR_LABEL:t.lockrLabel||t.number,X:t.x!==void 0?Math.round(t.x):0,Y:t.y!==void 0?Math.round(t.y):0,FRONT_VIEW_X:t.frontViewX?Math.round(t.frontViewX):void 0,FRONT_VIEW_Y:t.frontViewY?Math.round(t.frontViewY):void 0,ROTATION:t.rotation||0,DOOR_DIRECTION:t.doorDirection,GROUP_NUM:t.groupNum,LOCKR_GENDR_SET:t.lockrGendrSet,LOCKR_STAT:t.lockrStat||this.mapAppStatusToDb(t.status),LOCKR_KND:t.lockrKnd||t.zoneId,LOCKR_TYPE_CD:t.lockrTypeCd||t.typeId,PARENT_LOCKR_CD:e,TIER_LEVEL:t.tierLevel||0,LOCKR_NO:t.lockrNo,MEM_SNO:t.memSno,MEM_NM:t.memNm,LOCKR_USE_S_DATE:t.lockrUseSDate,LOCKR_USE_E_DATE:t.lockrUseEDate,BUY_EVENT_SNO:t.buyEventSno,MEMO:t.memo,UPDATE_BY:t.updateBy,COMP_CD:t.compCd||"001",BCOFF_CD:t.bcoffCd||"001"}}mapDbStatusToApp(t){return{"00":"available","01":"occupied","02":"occupied","03":"maintenance","04":"maintenance","05":"expired"}[t]||"available"}mapAppStatusToDb(t){return{available:"00",occupied:"01",expired:"05",maintenance:"03"}[t]||"00"}async handleResponse(t){if(t.status===401&&this.useCodeIgniter)throw window.location.href="/login",new Error("Authentication required");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return t.json()}async getLockers(t,e,c=!1){try{if(this.useCodeIgniter){const w=Fe();t=t||w.companyCode,e=e||w.officeCode}const p=new URLSearchParams;t&&p.append("COMP_CD",t),e&&p.append("BCOFF_CD",e),c||p.append("parentOnly","true");const k=`${this.baseUrl}/lockrs?${p}`;console.log("[LockerApi] Fetching lockers from:",k);const l=await fetch(k,{method:"GET",headers:this.headers,credentials:"omit"}),d=await this.handleResponse(l),f=d.lockers||d;console.log("[LockerApi] Received",f.length,"lockers from backend");const M=f.map((w,F)=>this.dbToAppFormat(w));return M.forEach(w=>{if(w.parentLockerId){const F=M.find($=>$.id===w.parentLockerId);F&&(F.childLockerIds||(F.childLockerIds=[]),F.childLockerIds.push(w.id))}}),M}catch(p){return console.error("[API] Failed to fetch lockers:",p),[]}}async getAllLockers(t=!1){return this.getLockers(void 0,void 0,t)}async saveLocker(t){try{const e=this.appToDbFormat(t),c=t.id.includes("temp")||t.id.includes("new");if(this.useCodeIgniter){const f=Fe();e.COMP_CD=e.COMP_CD||f.companyCode,e.BCOFF_CD=e.BCOFF_CD||f.officeCode}const p=c?`${this.baseUrl}/lockrs`:`${this.baseUrl}/lockrs/${this.extractDbId(t.id)}`,k=await fetch(p,{method:c?"POST":"PUT",headers:this.headers,body:JSON.stringify(e),credentials:"omit"});if(!k.ok)throw new Error(`HTTP error! status: ${k.status}`);const d=await k.json();return this.dbToAppFormat(d)}catch(e){return console.error("[API] Failed to save locker:",e),null}}async deleteLocker(t){try{const e=this.extractDbId(t),c=`${this.baseUrl}/lockrs/${e}`;return(await fetch(c,{method:"DELETE",headers:this.headers,credentials:"omit"})).ok}catch(e){return console.error("[API] Failed to delete locker:",e),!1}}async batchSaveLockers(t){let e=0;for(const c of t)await this.saveLocker(c)&&e++;return e}async testConnection(){try{return(await fetch(`${this.baseUrl}/health`,{method:"GET",headers:this.headers})).ok}catch(t){return console.error("[API] Database connection test failed:",t),!1}}async addTiers(t,e,c,p,k){try{console.log("[API DEBUG] addTiers called with:",{parentLockrCd:t,tierCount:e,parentFrontViewX:c,parentFrontViewY:p,startTierLevel:k}),console.log("[API DEBUG] baseUrl:",this.baseUrl);const l=`${this.baseUrl}/lockrs/${t}/tiers`;console.log("[API DEBUG] Request URL:",l);const d=await fetch(l,{method:"POST",headers:this.headers,body:JSON.stringify({tierCount:e,parentFrontViewX:c,parentFrontViewY:p,startTierLevel:k})});if(!d.ok)throw new Error(`HTTP error! status: ${d.status}`);const f=await d.json();return(f.tiers||f).map((F,$)=>this.dbToAppFormat(F))}catch(l){return console.error("[API] Failed to add tiers:",l),[]}}async getChildren(t){try{const e=await fetch(`${this.baseUrl}/lockrs/${t}/children`,{method:"GET",headers:this.headers});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const c=await e.json();return(c.children||c).map(k=>this.dbToAppFormat(k))}catch(e){return console.error("[API] Failed to get children:",e),[]}}async updateLocker(t,e){try{const c=this.appToDbFormat(e),p=await fetch(`${this.baseUrl}/lockrs/${t}`,{method:"PUT",headers:this.headers,body:JSON.stringify(c)});if(!p.ok)throw new Error(`HTTP error! status: ${p.status}`);const k=await p.json();return this.dbToAppFormat(k)}catch(c){return console.error("[API] Failed to update locker:",c),null}}async createLocker(t){try{const e=this.appToDbFormat(t),c=await fetch(`${this.baseUrl}/lockrs`,{method:"POST",headers:this.headers,body:JSON.stringify(e)});if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);const p=await c.json();return this.dbToAppFormat(p)}catch(e){return console.error("[API] Failed to create locker:",e),null}}extractDbId(t){const e=t.match(/\d+/);return e?parseInt(e[0]):0}}const J=new Ze,Qt=Ke("locker",()=>{const r=b([]),t=b([]),e=b([{id:"1",name:"소형",width:40,depth:40,height:40,color:"#3b82f6"},{id:"2",name:"중형",width:50,depth:50,height:60,color:"#10b981"},{id:"3",name:"대형",width:60,depth:60,height:80,color:"#f59e0b"}]),c=b(null),p=b("floor"),k=b("flat"),l=b(1),d=b([]),f=b(-1),M=b(!0),w=b(!1),F=b(null),$=b("disconnected"),z=L(()=>r.value.find(n=>n.id===c.value)),V=L(()=>{const n={total:r.value.length,available:0,occupied:0,expired:0,maintenance:0};return r.value.forEach(u=>{n[u.status]++}),n}),X=L(()=>r.value.filter(n=>n.floor===l.value||!n.floor)),E=()=>{d.value=d.value.slice(0,f.value+1),d.value.push(JSON.parse(JSON.stringify(r.value))),f.value++,d.value.length>50&&(d.value.shift(),f.value--)},R=async n=>{const u=`temp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,g={...n,rotation:n.rotation||0,id:u};if(E(),r.value.push(g),console.log("[Store] Added locker with rotation:",g.rotation),M.value){w.value=!0;try{const y=await J.saveLocker(g);if(y){const _=r.value.findIndex(Y=>Y.id===u);_!==-1&&(r.value[_]=y),console.log("[Store] Locker saved to database:",y.id)}else console.warn("[Store] Failed to save to database, keeping local copy")}catch(y){console.error("[Store] Database save error:",y)}finally{w.value=!1}}return g},D=async(n,u,g=!1)=>{const y=r.value.findIndex(_=>_.id===n);if(y!==-1){if(E(),"rotation"in u&&(isNaN(u.rotation)||u.rotation===void 0)&&(console.warn("[Store] Invalid rotation value, using existing or 0"),u.rotation=r.value[y].rotation||0),r.value[y]={...r.value[y],...u},M.value&&!n.includes("temp")&&!g){w.value=!0;try{await J.saveLocker(r.value[y])||console.warn("[Store] Failed to sync update to database")}catch(_){console.error("[Store] Database update error:",_)}finally{w.value=!1}}return r.value[y]}return null},fe=n=>{E();const u=new Map(n.map(g=>[g.id,g.updates]));r.value=r.value.map(g=>{const y=u.get(g.id);return y?("rotation"in y&&(isNaN(y.rotation)||y.rotation===void 0)&&(y.rotation=g.rotation||0),{...g,...y}):g}),console.log(`[Store] Batch updated ${n.length} lockers simultaneously`)},ge=n=>r.value.find(u=>u.id===n)||null,h=async n=>{const u=r.value.findIndex(g=>g.id===n);if(u!==-1&&(E(),r.value.splice(u,1),M.value&&!n.includes("temp"))){w.value=!0;try{await J.deleteLocker(n)||console.warn("[Store] Failed to delete from database")}catch(g){console.error("[Store] Database delete error:",g)}finally{w.value=!1}}},Z=()=>{f.value>0&&(f.value--,r.value=JSON.parse(JSON.stringify(d.value[f.value])))},me=()=>{f.value<d.value.length-1&&(f.value++,r.value=JSON.parse(JSON.stringify(d.value[f.value])))},ne=n=>{c.value=n},pe=n=>{const u={...n,id:`zone-${Date.now()}-${Math.random().toString(36).substr(2,9)}`};return t.value.push(u),u},se=n=>{p.value=n},ye=n=>{k.value=n,console.log(`[Store] Placement mode changed to: ${n}`)},ke=n=>{l.value=n},Q=n=>{const u=(n.rotation||0)*Math.PI/180,g=Math.cos(u),y=Math.sin(u),_=n.x+n.width/2,Y=n.y+n.height/2,N=[{x:-n.width/2,y:-n.height/2},{x:n.width/2,y:-n.height/2},{x:n.width/2,y:n.height/2},{x:-n.width/2,y:n.height/2}].map(I=>({x:I.x*g-I.y*y+_,y:I.x*y+I.y*g+Y})),A=N.map(I=>I.x),O=N.map(I=>I.y);return{left:Math.min(...A),right:Math.max(...A),top:Math.min(...O),bottom:Math.max(...O),width:Math.max(...A)-Math.min(...A),height:Math.max(...O)-Math.min(...O)}},we=(n,u,g,y=!1)=>{const _=g||n.zoneId,Y=r.value.filter(N=>N.zoneId===_),B=y?1:0;for(const N of Y){if(N.id===u||N.id===n.id)continue;const A=Q({...n,rotation:n.rotation||0}),O=Q(N);y&&console.log("[Rotation Collision Check]",{rotating:{id:n.id||u,bounds:A,rotation:n.rotation},checking:{id:N.id,bounds:O,rotation:N.rotation}});const I=Math.max(A.left,O.left),Me=Math.min(A.right,O.right),Ce=Math.max(A.top,O.top),ae=Math.min(A.bottom,O.bottom),ie=Me-I,ce=ae-Ce;if(ie>B&&ce>B)return console.log("[Collision] Detected overlap:",{overlapWidth:ie,overlapHeight:ce,tolerance:B,isRotating:y}),!0}return!1},be=()=>{t.value=[{id:"zone-1",name:"남자 탈의실",x:0,y:0,width:800,height:600,color:"#f0f9ff"},{id:"zone-2",name:"여자 탈의실",x:0,y:0,width:800,height:600,color:"#fef3c7"},{id:"zone-3",name:"혼용 탈의실",x:0,y:0,width:800,height:600,color:"#fee2e2"}];const n=40;[{id:"L1",zoneId:"zone-1",x:40,y:100,status:"available"},{id:"L2",zoneId:"zone-1",x:80,y:100,status:"occupied"},{id:"L3",zoneId:"zone-1",x:120,y:100,status:"available"},{id:"L4",zoneId:"zone-1",x:40,y:140,status:"expired"},{id:"L5",zoneId:"zone-1",x:80,y:140,status:"maintenance"},{id:"L6",zoneId:"zone-2",x:40,y:100,status:"available"},{id:"L7",zoneId:"zone-2",x:80,y:100,status:"occupied"},{id:"L8",zoneId:"zone-2",x:120,y:100,status:"available"},{id:"L9",zoneId:"zone-3",x:40,y:100,status:"available"},{id:"L10",zoneId:"zone-3",x:80,y:100,status:"occupied"}].forEach((g,y)=>{r.value.push({id:`locker-${y}`,number:g.id,x:g.x,y:g.y,width:n,depth:n,height:n,status:g.status,rotation:0,zoneId:g.zoneId,typeId:"1"})}),console.log("[Store] Test data initialized with adjacent lockers (no gaps)")},ee=async(n=!1)=>{if(console.log("[STORE] 🔥 loadLockersFromDatabase() called!"),console.log(`[STORE] isOnlineMode: ${M.value}`),console.log(`[STORE] includeChildren: ${n}`),console.log("[STORE] Stack trace:",new Error().stack),!!M.value){w.value=!0;try{console.log(`[STORE] Calling lockerApi.getAllLockers(${n})`);const u=await J.getAllLockers(n);console.log(`[STORE] Got ${u.length} lockers from API`),u.length>0?(r.value=u,F.value=new Date,$.value="connected",console.log(`[Store] ✅ Loaded ${u.length} lockers from database`)):(console.log("[Store] No lockers found in database"),$.value="connected")}catch(u){console.error("[Store] Failed to load from database:",u),$.value="error"}finally{w.value=!1}}},re=async n=>(M.value=n,n?await J.testConnection()?($.value="connected",await ee(),!0):($.value="error",M.value=!1,console.error("[Store] Cannot connect to database"),!1):($.value="disconnected",console.log("[Store] Switched to offline mode"),!0)),le=async()=>{if(M.value){w.value=!0;try{const n=await J.batchSaveLockers(r.value);console.log(`[Store] Synced ${n}/${r.value.length} lockers`),F.value=new Date}catch(n){console.error("[Store] Sync failed:",n)}finally{w.value=!1}}};return{lockers:r,zones:t,lockerTypes:e,selectedLockerId:c,viewMode:p,placementMode:k,currentFloor:l,selectedLocker:z,lockersByStatus:V,currentFloorLockers:X,addLocker:R,updateLocker:D,batchUpdateLockers:fe,deleteLocker:h,selectLocker:ne,addZone:pe,setViewMode:se,setPlacementMode:ye,setCurrentFloor:ke,initTestData:be,undo:Z,redo:me,checkCollision:we,getRotatedBounds:Q,getLockerById:ge,isOnlineMode:he(M),isSyncing:he(w),lastSyncTime:he(F),connectionStatus:he($),loadLockersFromDatabase:ee,toggleOnlineMode:re,syncToDatabase:le}}),Qe=["data-locker-id","transform"],et=["d"],tt=["x","y","width","height","fill","stroke","stroke-width","rx","ry","opacity"],ot=["x2","y1","y2","stroke"],nt=["x2","y1","y2","stroke"],st={key:3},rt=["x2","y1","y2"],lt=["y","width","height","onMouseenter"],at=["y","width","height"],it=["y"],ct=["y"],dt=["width","height"],ut=["transform"],ht=["x","y","width","height"],vt=["x","y","width","height"],ft=["points"],gt=["x","y"],mt=["d","fill"],pt=["x","y","dominant-baseline","font-size","fill"],yt=["x","y","font-size"],kt={key:8,class:"rotation-handle"},wt=["x1","x2"],bt=["cx"],Mt={key:0},Ct=["x"],St=["x"],$t=["cx"],T=2,Et=Te({__name:"LockerSVG",props:{locker:{},isSelected:{type:Boolean},isMultiSelected:{type:Boolean},isDragging:{type:Boolean},viewMode:{},isTransitioningToFloor:{type:Boolean},showNumber:{type:Boolean},showRotateHandle:{type:Boolean},hasError:{type:Boolean},shouldHideIndividualOutline:{type:Boolean},adjacentSides:{},zoomLevel:{},isManagementPage:{type:Boolean},childLockers:{}},emits:["click","select","dragstart","rotatestart","rotate","rotateend"],setup(r,{emit:t}){var Le;const e=r,c=L(()=>e.viewMode==="front"&&e.locker.frontViewX!==void 0?e.locker.frontViewX:e.locker.x),p=L(()=>e.viewMode==="front"&&e.locker.frontViewY!==void 0?e.locker.frontViewY:e.locker.y),k=t,l=b(!1),d=b(!1),f=b(0),M=b(0),w=b(!1),F=b(0),$=b(null),z=b(!1),V=b(null),X=b(null),E=b({x:0,y:0}),R=b({width:80,height:28}),D=b({x:0,y:0}),fe=L(()=>{if(!z.value||!e.locker.rotation)return"";const o=e.locker.rotation||0,s=h.value.width/2,a=h.value.height/2;return`rotate(${-o}, ${s}, ${a})`}),ge=L(()=>{const a=h.value.width+10,m=h.value.height+10;if(e.isDragging&&e.adjacentSides&&e.adjacentSides.length>0){const v=[],x={topLeft:"-5,-5",topRight:`${-5+a},-5`,bottomRight:`${-5+a},${-5+m}`,bottomLeft:`-5,${-5+m}`};return e.adjacentSides.includes("top")||v.push(`M ${x.topLeft} L ${x.topRight}`),e.adjacentSides.includes("right")||v.push(`M ${x.topRight} L ${x.bottomRight}`),e.adjacentSides.includes("bottom")||v.push(`M ${x.bottomRight} L ${x.bottomLeft}`),e.adjacentSides.includes("left")||v.push(`M ${x.bottomLeft} L ${x.topLeft}`),v.join(" ")}return`M -5,-5 L ${-5+a},-5 L ${-5+a},${-5+m} L -5,${-5+m} Z`}),h=L(()=>{if(!e.locker)return console.warn("[LockerSVG] props.locker is undefined, using defaults"),{width:40*T,height:40*T};const o=(e.locker.width||40)*T,s=(e.locker.depth||40)*T,a=(e.locker.height||40)*T,m=(e.locker.actualHeight||40)*T;if(e.viewMode==="floor")return{width:o,height:s||a||o};{const v=a||m||60*T;return{width:o,height:v}}}),Z=L(()=>e.viewMode==="front"?3*T:2*T),me=L(()=>{if(e.hasError||e.locker.hasError)return"#fee2e2";if(e.isManagementPage)return"transparent";let o="#FFFFFF";if(e.locker.color)o=e.locker.color+"20";else switch(e.locker.status){case"available":o="#FFFFFF";break;case"occupied":o="#FFF7ED";break;case"expired":o="#FEF2F2";break;case"maintenance":o="#F9FAFB";break;default:o="#FFFFFF"}return e.isSelected?e.locker.color?e.locker.color+"30":o==="#FFFFFF"?"#E6F4FF":o:l.value?e.locker.color?e.locker.color+"25":o==="#FFFFFF"?"#F0F8FF":o:o}),ne=L(()=>{if(e.hasError||e.locker.hasError)return"#ef4444";if(e.isManagementPage||e.viewMode==="front")return"#9ca3af";let o="#D1D5DB";if(e.locker.color)o=e.locker.color;else switch(e.locker.status){case"available":o="#D1D5DB";break;case"occupied":o="#FB923C";break;case"expired":o="#EF4444";break;case"maintenance":o="#6B7280";break;default:o="#D1D5DB"}return e.isSelected||e.isMultiSelected?o:l.value&&e.locker.color||o}),pe=L(()=>{const o=e.zoomLevel||1;return e.hasError||e.locker.hasError?2*T/o:e.isSelected||e.isMultiSelected||l.value?1*T/o:.5*T/o}),se=L(()=>e.viewMode==="front"?4*T:8*T),ye=L(()=>{if(e.hasError||e.locker.hasError)return"#dc2626";if(e.locker.color)return e.locker.color;switch(e.locker.status){case"available":return"#6b7280";case"occupied":return"#ea580c";case"expired":return"#dc2626";case"maintenance":return"#374151";default:return"#6b7280"}}),ke=L(()=>{const s=h.value.height-7*T,a=h.value.width,m=7*T,v=Z.value;return`
    M 0 ${s}
    L ${0+a} ${s}
    L ${0+a} ${s+m-v}
    Q ${0+a} ${s+m} ${0+a-v} ${s+m}
    L ${0+v} ${s+m}
    Q 0 ${s+m} 0 ${s+m-v}
    L 0 ${s}
    Z
  `}),Q=L(()=>{if(e.viewMode==="front")return"#374151";switch(e.locker.status){case"available":return"#374151";case"occupied":return"#92400E";case"expired":return"#991B1B";case"maintenance":return"#374151";default:return"#374151"}}),we=L(()=>e.viewMode==="front"&&e.locker.tierLevel&&e.locker.tierLevel>0),be=L(()=>e.isTransitioningToFloor&&e.locker.tierLevel&&e.locker.tierLevel>0);L(()=>{const s=((e.locker.rotation||0)%360+360)%360;return s===90||s===270});const ee=o=>{if(!e.childLockers)return 0;const s=e.childLockers.length+1;return 1+(h.value.height-2)/s*(o+1)},re=o=>{if(!e.childLockers)return 0;const s=e.childLockers.length+1,a=(h.value.height-2)/s;return 1+a*o+a/2},le=o=>{if(!e.childLockers)return 1;const s=e.childLockers.length+1;return 1+(h.value.height-2)/s*o},n=()=>{if(!e.childLockers)return h.value.height-2;const o=e.childLockers.length+1;return(h.value.height-2)/o},u=o=>{const s=o.currentTarget,a=s.ownerSVGElement;if(console.log("updateMousePosition - svgElement:",s,"rootSVG:",a),a&&s)try{const m=s.getScreenCTM();if(m){const v=m.inverse(),x=a.createSVGPoint();x.x=o.clientX,x.y=o.clientY;const H=x.matrixTransform(v);console.log("Client position:",{clientX:o.clientX,clientY:o.clientY}),console.log("CTM transformed position:",{x:H.x,y:H.y}),D.value={x:H.x,y:H.y}}else{console.warn("CTM not available, falling back to bounding rect method");const v=a.getBoundingClientRect();D.value={x:o.clientX-v.left,y:o.clientY-v.top}}}catch(m){console.error("Error in CTM transformation:",m);const v=a.getBoundingClientRect();D.value={x:o.clientX-v.left,y:o.clientY-v.top}}else console.error("Root SVG not available for mouse position calculation")},g=()=>{if(!D.value){console.warn("No mouse position available for tooltip");return}console.log("Updating tooltip position, mouse:",D.value);let o=0,s=0;const a=e.locker.rotation;switch(e.locker.displayWidth,e.locker.displayHeight,a){case 0:o=D.value.x-40,s=D.value.y-40;break;case 90:o=20-D.value.y,s=D.value.x-40;break;case 180:o=20-D.value.x,s=20-D.value.y;break;case 270:o=20-D.value.y,s=20-D.value.x;break}E.value={x:o,y:s},console.log("Final tooltip position:",E.value)},y=(o,s,a)=>{_(),u(a),console.log("Starting tooltip timer for section:",o,"mouse position:",D.value),X.value=setTimeout(()=>{z.value=!0,V.value={displayNumber:o==="parent"||o==="single"?O():I(s)},console.log("Tooltip activated. Data:",V.value,"showTooltip:",z.value),g(),console.log("Tooltip position set to:",E.value)},400)},_=()=>{X.value&&(clearTimeout(X.value),X.value=null),z.value=!1,V.value=null};console.log("=== Tooltip Rendering Conditions ==="),console.log("isManagementPage:",e.isManagementPage),console.log("viewMode:",e.viewMode),console.log("childLockers:",e.childLockers),console.log("childLockers length:",(Le=e.childLockers)==null?void 0:Le.length),console.log("All conditions met:",e.isManagementPage&&e.viewMode==="floor"&&e.childLockers&&e.childLockers.length>0),console.log("====================================="),e.isManagementPage&&e.viewMode==="floor"&&e.childLockers&&(console.log(`Locker ${e.locker.lockrCd} - childLockers:`,e.childLockers),console.log(`isManagementPage: ${e.isManagementPage}, viewMode: ${e.viewMode}`));const Y=()=>e.locker&&e.locker.lockrNo!==void 0&&e.locker.lockrNo!==null?String(e.locker.lockrNo):"",B=()=>e.locker&&(e.locker.lockrLabel||e.locker.frontViewNumber||e.locker.number)||"",N=()=>e.locker?e.viewMode==="floor"?Y():B():"",A=()=>e.locker?(e.viewMode==="floor",B()):"",O=()=>e.isManagementPage?N():A(),I=o=>o?e.isManagementPage&&o.lockrNo!==void 0&&o.lockrNo!==null?String(o.lockrNo):o.lockrLabel||o.number||"":"",Me=o=>{o.stopPropagation(),k("click",e.locker,o),k("select",e.locker.id),console.log("Locker clicked:",e.locker.id,"Ctrl:",o.ctrlKey,"Shift:",o.shiftKey)},Ce=o=>{o.preventDefault(),k("dragstart",e.locker,o)},ae=(o,s,a)=>{const m=o.clientX-s,v=o.clientY-a;let x=Math.atan2(v,m)*(180/Math.PI)+90;return x<0&&(x+=360),x},ie=(o,s)=>{const a=(o%360+360)%360;let v=(s%360+360)%360-a;return v>180?v-=360:v<-180&&(v+=360),v},ce=o=>{o.stopPropagation(),o.preventDefault(),d.value=!0,f.value=e.locker.rotation||0,F.value=e.locker.rotation||0;const s=o.currentTarget.closest("g[data-locker-id]");if(!s)return;const a=s.getBoundingClientRect(),m=a.left+a.width/2,v=a.top+a.height/2;M.value=ae(o,m,v);let x=M.value;const H=Se=>{if(!d.value)return;const _e=ae(Se,m,v),Pe=ie(x,_e);x=_e,F.value+=Pe;let K=F.value;if(Se.shiftKey)K=Math.round(K/15)*15,w.value=!0;else if(Se.altKey)w.value=!1;else{const Ue=[0,45,90,135,180,225,270,315],Oe=8;w.value=!1;const $e=(K%360+360)%360;for(const de of Ue)if(Math.abs($e-de)<Oe||de===0&&Math.abs($e-360)<Oe){const Ee=Math.floor(K/360);de===0?$e>180?K=(Ee+1)*360:K=Ee*360:K=Ee*360+de,w.value=!0;break}}k("rotate",e.locker.id,K)},De=()=>{d.value&&(d.value=!1,w.value=!1,document.removeEventListener("mousemove",H),document.removeEventListener("mouseup",De),k("rotateend",e.locker.id))};document.addEventListener("mousemove",H),document.addEventListener("mouseup",De),k("rotatestart",e.locker,o)};return(o,s)=>(S(),C("g",{"data-locker-id":o.locker.id,transform:`translate(${c.value}, ${p.value}) rotate(${o.locker.rotation||0}, ${h.value.width/2}, ${h.value.height/2})`,onClick:oe(Me,["stop"]),onMousedown:oe(Ce,["prevent"]),onMouseenter:s[8]||(s[8]=a=>l.value=!0),onMouseleave:s[9]||(s[9]=a=>l.value=!1),class:q(["locker-svg",{"locker-selected":o.isSelected,"locker-hovered":l.value,"locker-dragging":o.isDragging}]),style:{cursor:"move"}},[i("g",{class:q({"child-locker-content":we.value,"child-locker-fade-out":be.value})},[(o.isSelected||o.isMultiSelected)&&!o.shouldHideIndividualOutline&&!o.isDragging?(S(),C("path",{key:0,d:ge.value,fill:"none",stroke:"#0768AE","stroke-width":"2","stroke-dasharray":"5,5",class:"selection-outline"},s[10]||(s[10]=[i("animate",{attributeName:"stroke-dashoffset",values:"0;10",dur:"0.5s",repeatCount:"indefinite"},null,-1)]),8,et)):P("",!0),i("rect",{x:o.viewMode==="front"?0:1,y:o.viewMode==="front"?0:1,width:o.viewMode==="front"?h.value.width:h.value.width-2,height:o.viewMode==="front"?h.value.height:h.value.height-2,fill:me.value,stroke:ne.value,"stroke-width":pe.value,rx:Z.value,ry:Z.value,"shape-rendering":"crispEdges",opacity:d.value?.8:1,style:{transition:"opacity 0.2s ease"}},null,8,tt),o.viewMode==="floor"&&!o.isManagementPage?(S(),C("line",{key:1,x1:10,x2:h.value.width-10,y1:h.value.height-4,y2:h.value.height-4,stroke:o.locker.color||"#1e40af","stroke-width":"4",opacity:"0.9","stroke-linecap":"square","shape-rendering":"crispEdges"},null,8,ot)):P("",!0),o.viewMode==="floor"&&o.isManagementPage?(S(),C("line",{key:2,x1:1,x2:h.value.width-1,y1:h.value.height+3,y2:h.value.height+3,stroke:ne.value,"stroke-width":"1.5","stroke-dasharray":"3,3","shape-rendering":"crispEdges"},null,8,nt)):P("",!0),e.isManagementPage&&o.viewMode==="floor"?(S(),C("g",st,[e.childLockers&&e.childLockers.length>0?(S(),C(te,{key:0},[(S(!0),C(te,null,ve(e.childLockers,(a,m)=>(S(),C("line",{key:`divider-${a.id}`,x1:1,x2:h.value.width-1,y1:ee(m),y2:ee(m),stroke:"#6b7280","stroke-width":"0.5",opacity:"0.8"},null,8,rt))),128)),(S(!0),C(te,null,ve(e.childLockers,(a,m)=>(S(),C("rect",{key:`section-${a.id}`,x:1,y:le(m),width:h.value.width-2,height:n(),fill:"transparent",class:q(["section-hover",{"section-hovered":$.value===`child-${m}`}]),onMouseenter:v=>{$.value=`child-${m}`,y(`child-${m}`,a,v)},onMousemove:s[0]||(s[0]=v=>{u(v),g()}),onMouseleave:s[1]||(s[1]=v=>{$.value=null,_()}),style:{cursor:"pointer"}},null,42,lt))),128)),i("rect",{x:1,y:le(e.childLockers.length),width:h.value.width-2,height:n(),fill:"transparent",class:q(["section-hover",{"section-hovered":$.value==="parent"}]),onMouseenter:s[2]||(s[2]=a=>{$.value="parent",y("parent",e.locker,a)}),onMousemove:s[3]||(s[3]=a=>{u(a),g()}),onMouseleave:s[4]||(s[4]=a=>{$.value=null,_()}),style:{cursor:"pointer"}},null,42,at),(S(!0),C(te,null,ve(e.childLockers,(a,m)=>(S(),C("text",{key:`label-${a.id}`,x:8,y:re(m)+1,"font-size":"7",fill:"#374151","font-weight":"600","text-anchor":"start","dominant-baseline":"middle",style:{"pointer-events":"none"}},j(I(a)),9,it))),128)),i("text",{x:8,y:re(e.childLockers.length)+1,"font-size":"7",fill:"#374151","font-weight":"600","text-anchor":"start","dominant-baseline":"middle",style:{"pointer-events":"none"}},j(O()),9,ct)],64)):(S(),C("rect",{key:1,x:1,y:1,width:h.value.width-2,height:h.value.height-2,fill:"transparent",class:q(["section-hover",{"section-hovered":$.value==="single"}]),onMouseenter:s[5]||(s[5]=a=>{$.value="single",y("single",e.locker,a)}),onMousemove:s[6]||(s[6]=a=>{u(a),g()}),onMouseleave:s[7]||(s[7]=a=>{$.value=null,_()}),style:{cursor:"pointer"}},null,42,dt))])):P("",!0),z.value&&V.value?(S(),C("g",{key:4,class:"tooltip",transform:fe.value},[i("rect",{x:E.value.x+2,y:E.value.y+2,width:R.value.width,height:R.value.height,fill:"rgba(0, 0, 0, 0.1)",rx:"6",ry:"6"},null,8,ht),i("rect",{x:E.value.x,y:E.value.y,width:R.value.width,height:R.value.height,fill:"rgba(0, 0, 0, 0.85)",stroke:"rgba(255, 255, 255, 0.2)","stroke-width":"0.5",rx:"6",ry:"6"},null,8,vt),i("polygon",{points:`${E.value.x+R.value.width/2-6},${E.value.y+R.value.height} ${E.value.x+R.value.width/2},${E.value.y+R.value.height+6} ${E.value.x+R.value.width/2+6},${E.value.y+R.value.height}`,fill:"rgba(0, 0, 0, 0.85)"},null,8,ft),i("text",{x:E.value.x+R.value.width/2,y:E.value.y+R.value.height/2+2,"font-size":"11",fill:"white","font-weight":"500","text-anchor":"middle","dominant-baseline":"middle","font-family":"system-ui, -apple-system, sans-serif"},j(V.value.displayNumber),9,gt)],8,ut)):P("",!0),o.viewMode==="front"&&o.showNumber!==!1&&O()?(S(),C("path",{key:5,d:ke.value,fill:ye.value,"shape-rendering":"crispEdges"},null,8,mt)):P("",!0),o.showNumber!==!1&&O()&&!(o.isManagementPage&&o.viewMode==="floor")?(S(),C("text",{key:6,x:h.value.width/2,y:o.viewMode==="front"?h.value.height-3*T:h.value.height/2,"text-anchor":"middle","dominant-baseline":(o.viewMode==="front","middle"),"font-size":se.value,fill:o.viewMode==="front"?"#ffffff":Q.value,"font-weight":"600",class:"locker-number",style:{"user-select":"none","pointer-events":"none"}},j(O()),9,pt)):P("",!0),o.viewMode==="front"&&e.locker.lockrNo?(S(),C("text",{key:7,x:4*T,y:6*T,"text-anchor":"start","dominant-baseline":"middle","font-size":se.value,fill:"#374151","font-weight":"600",class:"locker-number-top",style:{"user-select":"none","pointer-events":"none"}},j(e.locker.lockrNo!==void 0&&e.locker.lockrNo!==null?e.locker.lockrNo:e.locker.lockrLabel||e.locker.number),9,yt)):P("",!0),o.isSelected&&o.showRotateHandle?(S(),C("g",kt,[i("line",{x1:h.value.width/2,y1:0,x2:h.value.width/2,y2:-25,stroke:"#0768AE","stroke-width":"2",opacity:"0.8"},null,8,wt),i("circle",{cx:h.value.width/2,cy:-25,r:"8",fill:"#0768AE",stroke:"#ffffff","stroke-width":"2",style:Ne({cursor:d.value?"grabbing":"grab"}),onMousedown:oe(ce,["stop"])},null,44,bt),d.value?(S(),C("g",Mt,[i("rect",{x:h.value.width/2-25,y:-50,width:"50",height:"20",rx:"10",fill:"white",stroke:"#0768AE","stroke-width":"1",opacity:"0.95"},null,8,Ct),i("text",{x:h.value.width/2,y:-36,"text-anchor":"middle","font-size":"12",fill:"#0768AE","font-weight":"600"},j(Math.round(((o.locker.rotation||0)%360+360)%360))+"° ",9,St),w.value?(S(),C("circle",{key:0,cx:h.value.width/2,cy:-25,r:"10",fill:"none",stroke:"#10b981","stroke-width":"2",opacity:"0.8"},s[11]||(s[11]=[i("animate",{attributeName:"r",values:"8;12;8",dur:"0.3s",begin:"0s"},null,-1)]),8,$t)):P("",!0)])):P("",!0)])):P("",!0)],2)],42,Qe))}}),eo=xe(Et,[["__scopeId","data-v-b40d7d2c"]]),Tt={class:"modal-overlay"},xt={class:"modal-container"},Lt={class:"modal-header"},Dt={class:"modal-body"},_t={class:"form-group"},Ot={class:"form-group"},Ft={class:"color-options"},Rt=["onClick"],It={class:"modal-footer"},Nt=["disabled"],At=Te({__name:"ZoneModal",emits:["close","save"],setup(r,{emit:t}){const e=t,c=b(""),p=b("#f0f9ff"),k=["#f0f9ff","#fef3c7","#fee2e2","#d1fae5","#f3e8ff","#fce7f3"],l=()=>{if(!c.value.trim()){alert("구역 이름을 입력해주세요.");return}e("save",{name:c.value.trim(),color:p.value})};return(d,f)=>(S(),C("div",Tt,[i("div",xt,[i("div",Lt,[f[4]||(f[4]=i("h2",{class:"modal-title"},"구역 추가",-1)),i("button",{class:"close-btn",onClick:f[0]||(f[0]=M=>d.$emit("close"))},f[3]||(f[3]=[i("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor"},[i("path",{d:"M4 4 L16 16 M16 4 L4 16",stroke:"currentColor","stroke-width":"2"})],-1)]))]),i("div",Dt,[i("div",_t,[f[5]||(f[5]=i("label",{for:"zone-name",class:"form-label"},"구역 이름",-1)),G(i("input",{id:"zone-name","onUpdate:modelValue":f[1]||(f[1]=M=>c.value=M),type:"text",class:"form-input",placeholder:"예: 남자 탈의실",onKeyup:Ve(l,["enter"])},null,544),[[W,c.value]])]),i("div",Ot,[f[6]||(f[6]=i("label",{class:"form-label"},"구역 색상 (선택)",-1)),i("div",Ft,[(S(),C(te,null,ve(k,M=>i("button",{key:M,class:q(["color-option",{selected:p.value===M}]),style:Ne({backgroundColor:M}),onClick:w=>p.value=M},null,14,Rt)),64))])])]),i("div",It,[i("button",{class:"btn-cancel",onClick:f[2]||(f[2]=M=>d.$emit("close"))}," 취소 "),i("button",{class:"btn-save",onClick:l,disabled:!c.value}," 추가 ",8,Nt)])])]))}}),to=xe(At,[["__scopeId","data-v-12568931"]]),Pt={class:"modal-overlay"},Ut={class:"modal-header"},zt={class:"modal-body"},Bt={class:"form-group"},Kt={class:"form-row"},Vt={class:"form-group"},Yt={class:"form-group"},Ht={class:"form-group"},Gt={class:"form-group"},Xt={class:"form-group"},jt={class:"modal-footer"},Jt=Te({__name:"LockerRegistrationModal",emits:["close","save"],setup(r,{emit:t}){const e=t,c=b({name:"",width:40,depth:40,height:60,description:"",color:"#4A90E2"}),p=()=>{if(!c.value.name||!c.value.width||!c.value.height||!c.value.depth){alert("필수 정보를 입력해주세요");return}e("save",{...c.value})};return(k,l)=>(S(),C("div",Pt,[i("div",{class:"modal-content",onKeydown:l[9]||(l[9]=oe(()=>{},["stop"])),onKeyup:l[10]||(l[10]=oe(()=>{},["stop"]))},[i("div",Ut,[l[11]||(l[11]=i("h2",null,"락커 등록",-1)),i("button",{class:"close-btn",onClick:l[0]||(l[0]=d=>k.$emit("close"))},"×")]),i("div",zt,[i("div",Bt,[l[12]||(l[12]=i("label",null,"락커 타입 이름",-1)),G(i("input",{"onUpdate:modelValue":l[1]||(l[1]=d=>c.value.name=d),type:"text",placeholder:"예: 소형, 중형, 대형",required:""},null,512),[[W,c.value.name]])]),i("div",Kt,[i("div",Vt,[l[13]||(l[13]=i("label",null,"가로 (Width)",-1)),G(i("input",{"onUpdate:modelValue":l[2]||(l[2]=d=>c.value.width=d),type:"number",min:"20",max:"200",placeholder:"cm",required:""},null,512),[[W,c.value.width,void 0,{number:!0}]])]),i("div",Yt,[l[14]||(l[14]=i("label",null,"깊이 (Depth)",-1)),G(i("input",{"onUpdate:modelValue":l[3]||(l[3]=d=>c.value.depth=d),type:"number",min:"20",max:"200",placeholder:"cm",required:""},null,512),[[W,c.value.depth,void 0,{number:!0}]])]),i("div",Ht,[l[15]||(l[15]=i("label",null,"높이 (Height)",-1)),G(i("input",{"onUpdate:modelValue":l[4]||(l[4]=d=>c.value.height=d),type:"number",min:"20",max:"300",placeholder:"cm",required:""},null,512),[[W,c.value.height,void 0,{number:!0}]])])]),i("div",Gt,[l[16]||(l[16]=i("label",null,"설명 (선택)",-1)),G(i("textarea",{"onUpdate:modelValue":l[5]||(l[5]=d=>c.value.description=d),rows:"3",placeholder:"락커 타입에 대한 설명",onKeydown:l[6]||(l[6]=d=>{console.log("[Modal Textarea] Keydown:",d.key,d.keyCode),d.key==="Backspace"&&console.log("[Modal Textarea] Backspace pressed - should work normally")})},null,544),[[W,c.value.description]])]),i("div",Xt,[l[18]||(l[18]=i("label",null,"색상 구분",-1)),G(i("select",{"onUpdate:modelValue":l[7]||(l[7]=d=>c.value.color=d)},l[17]||(l[17]=[He('<option value="#4A90E2" data-v-fa6437c9>파란색</option><option value="#7ED321" data-v-fa6437c9>초록색</option><option value="#F5A623" data-v-fa6437c9>주황색</option><option value="#BD10E0" data-v-fa6437c9>보라색</option><option value="#9013FE" data-v-fa6437c9>남색</option>',5)]),512),[[Ye,c.value.color]])])]),i("div",jt,[i("button",{class:"btn-cancel",onClick:l[8]||(l[8]=d=>k.$emit("close"))},"취소"),i("button",{class:"btn-save",onClick:p},"등록")])],32)]))}}),oo=xe(Jt,[["__scopeId","data-v-fa6437c9"]]);export{eo as L,to as Z,oo as a,U as g,Ae as i,Qt as u};
