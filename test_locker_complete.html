<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë½ì»¤ ë°°ì¹˜ ì‹œìŠ¤í…œ í†µí•© í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #4A90E2;
            padding-bottom: 10px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .test-section {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #f9f9f9;
        }
        .test-section h3 {
            margin-top: 0;
            color: #4A90E2;
        }
        button {
            background-color: #4A90E2;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #357ABD;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            background-color: white;
            border-left: 3px solid #4A90E2;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .success {
            border-left-color: #5cb85c;
            background-color: #f0fff0;
        }
        .error {
            border-left-color: #d9534f;
            background-color: #fff0f0;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .status-success {
            background-color: #5cb85c;
        }
        .status-error {
            background-color: #d9534f;
        }
        .status-warning {
            background-color: #f0ad4e;
        }
        .summary {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ ë½ì»¤ ë°°ì¹˜ ì‹œìŠ¤í…œ í†µí•© í…ŒìŠ¤íŠ¸</h1>
        
        <!-- ì „ì²´ í…ŒìŠ¤íŠ¸ ìš”ì•½ -->
        <div class="summary">
            <h3>í…ŒìŠ¤íŠ¸ ìƒíƒœ</h3>
            <p><span class="status-indicator status-success"></span> API ì—°ê²°: <span id="apiStatus">ê²€ì‚¬ ì¤‘...</span></p>
            <p><span class="status-indicator status-success"></span> LockerPlacement ë¡œë“œ: <span id="placementStatus">ê²€ì‚¬ ì¤‘...</span></p>
            <p><span class="status-indicator status-success"></span> ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°: <span id="dbStatus">ê²€ì‚¬ ì¤‘...</span></p>
        </div>

        <div class="test-grid">
            <!-- ë½ì»¤ íƒ€ì… í…ŒìŠ¤íŠ¸ -->
            <div class="test-section">
                <h3>ğŸ“¦ ë½ì»¤ íƒ€ì… ê´€ë¦¬</h3>
                <button onclick="testLoadTypes()">íƒ€ì… ëª©ë¡ ì¡°íšŒ</button>
                <button onclick="testAddType()">ìƒˆ íƒ€ì… ì¶”ê°€</button>
                <button onclick="refreshTypes()">ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
                <div id="typesResult" class="result"></div>
            </div>

            <!-- êµ¬ì—­ í…ŒìŠ¤íŠ¸ -->
            <div class="test-section">
                <h3>ğŸ—ºï¸ êµ¬ì—­ ê´€ë¦¬</h3>
                <button onclick="testLoadZones()">êµ¬ì—­ ëª©ë¡ ì¡°íšŒ</button>
                <button onclick="testAddZone()">ìƒˆ êµ¬ì—­ ì¶”ê°€</button>
                <button onclick="refreshZones()">ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
                <div id="zonesResult" class="result"></div>
            </div>

            <!-- ë½ì»¤ í…ŒìŠ¤íŠ¸ -->
            <div class="test-section">
                <h3>ğŸ” ë½ì»¤ ê´€ë¦¬</h3>
                <button onclick="testLoadLockers()">ë½ì»¤ ëª©ë¡ ì¡°íšŒ</button>
                <button onclick="testAddLocker()">ìƒˆ ë½ì»¤ ì¶”ê°€</button>
                <button onclick="testSaveLayout()">ë ˆì´ì•„ì›ƒ ì €ì¥</button>
                <div id="lockersResult" class="result"></div>
            </div>

            <!-- LockerPlacement í†µí•© í…ŒìŠ¤íŠ¸ -->
            <div class="test-section">
                <h3>ğŸ¯ LockerPlacement í†µí•©</h3>
                <button onclick="testPlacementIntegration()">í†µí•© ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</button>
                <button onclick="testPlacementMethods()">ë©”ì„œë“œ í™•ì¸</button>
                <button onclick="testStateSync()">ìƒíƒœ ë™ê¸°í™” í™•ì¸</button>
                <div id="integrationResult" class="result"></div>
            </div>
        </div>

        <!-- ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ -->
        <div style="margin-top: 30px;">
            <h3>ğŸ”§ ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h3>
            <button onclick="runCompleteTest()" style="background-color: #5cb85c; font-size: 16px; padding: 12px 24px;">
                ì „ì²´ ì‹œìŠ¤í…œ ê²€ì¦ ì‹¤í–‰
            </button>
            <div id="completeTestResult" class="result" style="margin-top: 20px; min-height: 100px;"></div>
        </div>
    </div>

    <!-- LockerConfig ì„¤ì • -->
    <script>
        window.LockerConfig = {
            baseUrl: '/SpoqPlus_Color_Admin_Except_Mobile_claude2',
            csrfHeader: 'X-CSRF-TOKEN',
            csrfHash: 'test-csrf-token',
            companyCode: '001',
            officeCode: '001'
        };
    </script>

    <!-- API ë° LockerPlacement ë¡œë“œ -->
    <script src="assets/js/locker-api.js"></script>
    <script src="assets/js/locker-placement-enhanced.js"></script>

    <script>
        // ì´ˆê¸° ìƒíƒœ í™•ì¸
        window.addEventListener('load', function() {
            // API ìƒíƒœ í™•ì¸
            document.getElementById('apiStatus').textContent = 
                window.LockerAPI ? 'âœ“ ë¡œë“œë¨' : 'âœ— ì‹¤íŒ¨';
            
            // LockerPlacement ìƒíƒœ í™•ì¸
            document.getElementById('placementStatus').textContent = 
                window.LockerPlacement ? 'âœ“ ë¡œë“œë¨' : 'âœ— ì‹¤íŒ¨';
            
            // ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í™•ì¸ (ê°„ì ‘ì )
            if (window.LockerAPI) {
                window.LockerAPI.getLockerTypes().then(types => {
                    document.getElementById('dbStatus').textContent = 'âœ“ ì—°ê²°ë¨';
                }).catch(err => {
                    document.getElementById('dbStatus').textContent = 'âœ— ì—°ê²° ì‹¤íŒ¨';
                });
            }
        });

        function showResult(elementId, data, isSuccess = true) {
            const element = document.getElementById(elementId);
            element.className = 'result ' + (isSuccess ? 'success' : 'error');
            element.textContent = typeof data === 'object' ? JSON.stringify(data, null, 2) : data;
        }

        // ë½ì»¤ íƒ€ì… í…ŒìŠ¤íŠ¸
        async function testLoadTypes() {
            try {
                const types = await window.LockerAPI.getLockerTypes();
                showResult('typesResult', {
                    message: 'íƒ€ì… ì¡°íšŒ ì„±ê³µ',
                    count: types.length,
                    types: types
                });
            } catch (error) {
                showResult('typesResult', 'ì˜¤ë¥˜: ' + error.message, false);
            }
        }

        async function testAddType() {
            try {
                const newType = await window.LockerAPI.addLockerType({
                    name: 'í…ŒìŠ¤íŠ¸ íƒ€ì… ' + Date.now(),
                    width: 45,
                    height: 45,
                    depth: 45,
                    color: '#' + Math.floor(Math.random()*16777215).toString(16)
                });
                
                if (newType) {
                    showResult('typesResult', {
                        message: 'íƒ€ì… ì¶”ê°€ ì„±ê³µ',
                        type: newType
                    });
                } else {
                    showResult('typesResult', 'íƒ€ì… ì¶”ê°€ ì‹¤íŒ¨', false);
                }
            } catch (error) {
                showResult('typesResult', 'ì˜¤ë¥˜: ' + error.message, false);
            }
        }

        async function refreshTypes() {
            if (window.LockerPlacement) {
                await window.LockerPlacement.loadLockerTypes();
                showResult('typesResult', 'LockerPlacement.loadLockerTypes() ì‹¤í–‰ ì™„ë£Œ');
            }
        }

        // êµ¬ì—­ í…ŒìŠ¤íŠ¸
        async function testLoadZones() {
            try {
                const zones = await window.LockerAPI.getZones();
                showResult('zonesResult', {
                    message: 'êµ¬ì—­ ì¡°íšŒ ì„±ê³µ',
                    count: zones.length,
                    zones: zones
                });
            } catch (error) {
                showResult('zonesResult', 'ì˜¤ë¥˜: ' + error.message, false);
            }
        }

        async function testAddZone() {
            try {
                const zoneName = 'í…ŒìŠ¤íŠ¸ êµ¬ì—­ ' + Date.now();
                const newZone = await window.LockerAPI.addZone(zoneName);
                
                if (newZone) {
                    showResult('zonesResult', {
                        message: 'êµ¬ì—­ ì¶”ê°€ ì„±ê³µ',
                        zone: newZone
                    });
                } else {
                    showResult('zonesResult', 'êµ¬ì—­ ì¶”ê°€ ì‹¤íŒ¨', false);
                }
            } catch (error) {
                showResult('zonesResult', 'ì˜¤ë¥˜: ' + error.message, false);
            }
        }

        async function refreshZones() {
            if (window.LockerPlacement) {
                await window.LockerPlacement.loadZones();
                showResult('zonesResult', 'LockerPlacement.loadZones() ì‹¤í–‰ ì™„ë£Œ');
            }
        }

        // ë½ì»¤ í…ŒìŠ¤íŠ¸
        async function testLoadLockers() {
            try {
                const lockers = await window.LockerAPI.getLockers('001', '001');
                showResult('lockersResult', {
                    message: 'ë½ì»¤ ì¡°íšŒ ì„±ê³µ',
                    count: lockers.length,
                    lockers: lockers.slice(0, 5) // ì²˜ìŒ 5ê°œë§Œ í‘œì‹œ
                });
            } catch (error) {
                showResult('lockersResult', 'ì˜¤ë¥˜: ' + error.message, false);
            }
        }

        async function testAddLocker() {
            try {
                const zones = await window.LockerAPI.getZones();
                if (zones.length === 0) {
                    showResult('lockersResult', 'êµ¬ì—­ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € êµ¬ì—­ì„ ì¶”ê°€í•˜ì„¸ìš”.', false);
                    return;
                }

                const newLocker = await window.LockerAPI.saveLocker({
                    typeId: '1',
                    x: Math.floor(Math.random() * 400),
                    y: Math.floor(Math.random() * 400),
                    rotation: 0,
                    zoneId: zones[0].id,
                    number: 'TEST-' + Date.now(),
                    status: 'available'
                });
                
                if (newLocker) {
                    showResult('lockersResult', {
                        message: 'ë½ì»¤ ì¶”ê°€ ì„±ê³µ',
                        locker: newLocker
                    });
                } else {
                    showResult('lockersResult', 'ë½ì»¤ ì¶”ê°€ ì‹¤íŒ¨', false);
                }
            } catch (error) {
                showResult('lockersResult', 'ì˜¤ë¥˜: ' + error.message, false);
            }
        }

        async function testSaveLayout() {
            if (window.LockerPlacement && window.LockerPlacement.saveLayout) {
                const result = await window.LockerPlacement.saveLayout();
                showResult('lockersResult', result ? 'ë ˆì´ì•„ì›ƒ ì €ì¥ ì„±ê³µ' : 'ë ˆì´ì•„ì›ƒ ì €ì¥ ì‹¤íŒ¨', result);
            } else {
                showResult('lockersResult', 'saveLayout ë©”ì„œë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', false);
            }
        }

        // LockerPlacement í†µí•© í…ŒìŠ¤íŠ¸
        function testPlacementIntegration() {
            if (!window.LockerPlacement) {
                showResult('integrationResult', 'LockerPlacementê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', false);
                return;
            }

            const state = window.LockerPlacement.state;
            showResult('integrationResult', {
                message: 'LockerPlacement ìƒíƒœ',
                lockerTypes: state.lockerTypes.length + 'ê°œ',
                zones: state.zones.length + 'ê°œ',
                lockers: state.lockers.length + 'ê°œ',
                selectedZone: state.selectedZone?.name || 'ì—†ìŒ',
                viewMode: state.currentViewMode
            });
        }

        function testPlacementMethods() {
            if (!window.LockerPlacement) {
                showResult('integrationResult', 'LockerPlacementê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', false);
                return;
            }

            const methods = Object.keys(window.LockerPlacement).filter(key => typeof window.LockerPlacement[key] === 'function');
            showResult('integrationResult', {
                message: 'ì‚¬ìš© ê°€ëŠ¥í•œ ë©”ì„œë“œ',
                count: methods.length,
                methods: methods
            });
        }

        async function testStateSync() {
            if (!window.LockerPlacement) {
                showResult('integrationResult', 'LockerPlacementê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', false);
                return;
            }

            // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
            await window.LockerPlacement.loadZones();
            await window.LockerPlacement.loadLockerTypes();
            
            const state = window.LockerPlacement.state;
            showResult('integrationResult', {
                message: 'ìƒíƒœ ë™ê¸°í™” ì™„ë£Œ',
                zonesLoaded: state.zones.length > 0,
                typesLoaded: state.lockerTypes.length > 0,
                lockersLoaded: state.lockers.length >= 0
            });
        }

        // ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
        async function runCompleteTest() {
            const results = [];
            const resultElement = document.getElementById('completeTestResult');
            resultElement.textContent = 'í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...\n';

            try {
                // 1. API í™•ì¸
                results.push({
                    test: 'API ë¡œë“œ',
                    status: window.LockerAPI ? 'PASS' : 'FAIL'
                });

                // 2. LockerPlacement í™•ì¸
                results.push({
                    test: 'LockerPlacement ë¡œë“œ',
                    status: window.LockerPlacement ? 'PASS' : 'FAIL'
                });

                // 3. íƒ€ì… ì¡°íšŒ
                const types = await window.LockerAPI.getLockerTypes();
                results.push({
                    test: 'ë½ì»¤ íƒ€ì… ì¡°íšŒ',
                    status: types.length > 0 ? 'PASS' : 'WARN',
                    count: types.length
                });

                // 4. êµ¬ì—­ ì¡°íšŒ
                const zones = await window.LockerAPI.getZones();
                results.push({
                    test: 'êµ¬ì—­ ëª©ë¡ ì¡°íšŒ',
                    status: zones.length > 0 ? 'PASS' : 'WARN',
                    count: zones.length
                });

                // 5. ë½ì»¤ ì¡°íšŒ
                const lockers = await window.LockerAPI.getLockers('001', '001');
                results.push({
                    test: 'ë½ì»¤ ëª©ë¡ ì¡°íšŒ',
                    status: 'PASS',
                    count: lockers.length
                });

                // 6. LockerPlacement ë©”ì„œë“œ í™•ì¸
                const requiredMethods = ['loadZones', 'loadLockerTypes', 'loadLockers', 'saveLayout'];
                const missingMethods = requiredMethods.filter(m => !window.LockerPlacement[m]);
                results.push({
                    test: 'LockerPlacement ë©”ì„œë“œ',
                    status: missingMethods.length === 0 ? 'PASS' : 'FAIL',
                    missing: missingMethods
                });

                // 7. ìƒíƒœ ë™ê¸°í™”
                await window.LockerPlacement.loadZones();
                await window.LockerPlacement.loadLockerTypes();
                const state = window.LockerPlacement.state;
                results.push({
                    test: 'ìƒíƒœ ë™ê¸°í™”',
                    status: (state.zones.length > 0 || state.lockerTypes.length > 0) ? 'PASS' : 'WARN'
                });

                // ê²°ê³¼ í‘œì‹œ
                const allPassed = results.every(r => r.status === 'PASS');
                const hasWarnings = results.some(r => r.status === 'WARN');
                
                resultElement.className = 'result ' + (allPassed ? 'success' : (hasWarnings ? '' : 'error'));
                resultElement.textContent = JSON.stringify({
                    overall: allPassed ? 'âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼' : (hasWarnings ? 'âš ï¸ ê²½ê³  ìˆìŒ' : 'âŒ ì¼ë¶€ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨'),
                    timestamp: new Date().toISOString(),
                    results: results
                }, null, 2);

            } catch (error) {
                resultElement.className = 'result error';
                resultElement.textContent = 'í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜:\n' + error.message;
            }
        }
    </script>
</body>
</html>