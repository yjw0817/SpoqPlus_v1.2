<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Markdown to HTML Converter - Fixed</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .controls {
            position: fixed;
            top: 10px;
            right: 10px;
            background: white;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 0 5px;
        }
        button:hover {
            background: #0056b3;
        }
        h1 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        h2 { color: #34495e; margin-top: 30px; }
        h3 { color: #7f8c8d; }
        code {
            background: #f4f4f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        pre {
            background: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            overflow-x: auto;
        }
        pre code {
            background: none;
            padding: 0;
        }
        blockquote {
            border-left: 4px solid #3498db;
            margin: 0;
            padding-left: 20px;
            color: #666;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        .mermaid {
            text-align: center;
            margin: 20px 0;
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 4px;
        }
        /* ë””ë²„ê·¸ìš© ìŠ¤íƒ€ì¼ */
        .debug-info {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
            display: none;
        }
        .debug-info.show {
            display: block;
        }
        @media print {
            .controls, .debug-info { display: none !important; }
            body { margin: 0; padding: 20px; }
            .mermaid { page-break-inside: avoid; }
        }
    </style>
</head>
<body>
    <div class="controls">
        <button onclick="loadPaymentDoc()">ê²°ì œ ë¬¸ì„œ ë¡œë“œ</button>
        <button onclick="loadRefundDoc()">í™˜ë¶ˆ ë¬¸ì„œ ë¡œë“œ</button>
        <button onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„</button>
        <button onclick="toggleDebug()">ğŸ› ë””ë²„ê·¸</button>
    </div>
    
    <div id="content">
        <h1>ë¬¸ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”</h1>
        <p>ìƒë‹¨ì˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë¬¸ì„œë¥¼ ë¡œë“œí•˜ì„¸ìš”.</p>
    </div>

    <div class="debug-info" id="debugInfo">
        <strong>ë””ë²„ê·¸ ì •ë³´:</strong>
        <div id="debugContent"></div>
    </div>

    <script>
        // ë””ë²„ê·¸ ë¡œê·¸ í•¨ìˆ˜
        function debugLog(message) {
            const debugContent = document.getElementById('debugContent');
            debugContent.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${message}</div>`;
            console.log(message);
        }

        // ë””ë²„ê·¸ í† ê¸€
        function toggleDebug() {
            document.getElementById('debugInfo').classList.toggle('show');
        }

        // Mermaid ì´ˆê¸°í™” - startOnLoadë¥¼ falseë¡œ ì„¤ì •
        mermaid.initialize({ 
            startOnLoad: false,
            theme: 'default',
            flowchart: {
                htmlLabels: true,
                curve: 'basis'
            }
        });
        debugLog('Mermaid ì´ˆê¸°í™” ì™„ë£Œ');

        // Marked ì„¤ì •
        marked.setOptions({
            breaks: true,
            gfm: true,
            headerIds: false
        });

        // ê³ ìœ  ID ìƒì„±ê¸°
        let mermaidIdCounter = 0;
        function generateMermaidId() {
            return `mermaid-diagram-${++mermaidIdCounter}`;
        }

        // Mermaid ì½”ë“œ ë¸”ë¡ì„ ì²˜ë¦¬í•˜ëŠ” ë Œë”ëŸ¬
        const renderer = new marked.Renderer();
        const originalCodeRenderer = renderer.code.bind(renderer);
        
        renderer.code = function(code, language, escaped) {
            if (language === 'mermaid') {
                const id = generateMermaidId();
                debugLog(`Mermaid ì½”ë“œ ë¸”ë¡ ë°œê²¬: ${id}`);
                // pre íƒœê·¸ì™€ í•¨ê»˜ mermaid í´ë˜ìŠ¤ë¥¼ ê°€ì§„ div ìƒì„±
                return `<div class="mermaid" id="${id}">${code}</div>`;
            }
            return originalCodeRenderer(code, language, escaped);
        };

        marked.use({ renderer });

        // Markdown ë Œë”ë§ ë° Mermaid ì²˜ë¦¬
        async function renderMarkdown(markdown) {
            try {
                debugLog('Markdown ë Œë”ë§ ì‹œì‘');
                
                // Markedë¡œ HTML ë³€í™˜
                const html = marked.parse(markdown);
                document.getElementById('content').innerHTML = html;
                debugLog('HTML ë³€í™˜ ì™„ë£Œ');
                
                // Mermaid ë‹¤ì´ì–´ê·¸ë¨ ì°¾ê¸°
                const mermaidElements = document.querySelectorAll('.mermaid');
                debugLog(`Mermaid ìš”ì†Œ ${mermaidElements.length}ê°œ ë°œê²¬`);
                
                if (mermaidElements.length > 0) {
                    // ê° Mermaid ìš”ì†Œ ì²˜ë¦¬
                    for (let element of mermaidElements) {
                        try {
                            const graphDefinition = element.textContent;
                            const id = element.id;
                            debugLog(`ì²˜ë¦¬ ì¤‘: ${id}`);
                            
                            // Mermaid ë Œë”ë§
                            const { svg } = await mermaid.render(id + '-svg', graphDefinition);
                            element.innerHTML = svg;
                            debugLog(`${id} ë Œë”ë§ ì„±ê³µ`);
                        } catch (error) {
                            debugLog(`Mermaid ë Œë”ë§ ì˜¤ë¥˜: ${error.message}`);
                            element.innerHTML = `<pre style="color: red;">Mermaid ì˜¤ë¥˜: ${error.message}</pre>`;
                        }
                    }
                }
                
                debugLog('ëª¨ë“  ì²˜ë¦¬ ì™„ë£Œ');
            } catch (error) {
                debugLog(`ì „ì²´ ì˜¤ë¥˜: ${error.message}`);
                console.error('ë Œë”ë§ ì˜¤ë¥˜:', error);
            }
        }

        function loadPaymentDoc() {
            mermaidIdCounter = 0; // ID ì¹´ìš´í„° ë¦¬ì…‹
            const paymentDoc = `# SpoqPlus ê²°ì œ ì‹œìŠ¤í…œ ìƒì„¸ ë¬¸ì„œ

## ëª©ì°¨
1. [ì‹œìŠ¤í…œ ê°œìš”](#ì‹œìŠ¤í…œ-ê°œìš”)
2. [ê²°ì œ í”„ë¡œì„¸ìŠ¤ í”Œë¡œìš°ì°¨íŠ¸](#ê²°ì œ-í”„ë¡œì„¸ìŠ¤-í”Œë¡œìš°ì°¨íŠ¸)
3. [ì£¼ìš” ì»´í¬ë„ŒíŠ¸](#ì£¼ìš”-ì»´í¬ë„ŒíŠ¸)

## ì‹œìŠ¤í…œ ê°œìš”

SpoqPlus ê²°ì œ ì‹œìŠ¤í…œì€ í”¼íŠ¸ë‹ˆìŠ¤/ìŠ¤í¬ì¸  ì„¼í„°ì— íŠ¹í™”ëœ ì¢…í•© ê´€ë¦¬ ì‹œìŠ¤í…œìœ¼ë¡œ ë‹¤ì–‘í•œ ìƒí’ˆ ìœ í˜•ì„ ì§€ì›í•©ë‹ˆë‹¤.

### ì£¼ìš” íŠ¹ì§•
- ë‹¤ì–‘í•œ ìƒí’ˆ ìœ í˜• ì§€ì› (ì´ìš©ê¶Œ, PT, ë¼ì»¤, 1ì¼ê¶Œ)
- ë³µìˆ˜ ê²°ì œ ìˆ˜ë‹¨ (ì¹´ë“œ, í˜„ê¸ˆ, ê³„ì¢Œì´ì²´, ë¯¸ìˆ˜)
- íœ´íšŒ ë° í™˜ë¶ˆ ê´€ë¦¬
- ë©€í‹° ì§€ì  ì§€ì›
- ì„ ë¬¼í•˜ê¸° ê¸°ëŠ¥

## ê²°ì œ í”„ë¡œì„¸ìŠ¤ í”Œë¡œìš°ì°¨íŠ¸

ì•„ë˜ëŠ” êµ¬ë§¤í•˜ê¸° ë²„íŠ¼ í´ë¦­ë¶€í„° ê²°ì œ ì™„ë£Œê¹Œì§€ì˜ ì „ì²´ í”„ë¡œì„¸ìŠ¤ì…ë‹ˆë‹¤:

\`\`\`mermaid
flowchart TD
    A[info_mem í˜ì´ì§€] --> B{êµ¬ë§¤í•˜ê¸° ë²„íŠ¼ í´ë¦­}
    B --> C[JavaScript: info_mem_buy_event]
    C --> D[Redirect: /teventmain/event_buy2/mem_sno]
    
    D --> E[event_buy2 Controller]
    E --> F[íšŒì› ì •ë³´ ì¡°íšŒ]
    E --> G[ì´ìš©ì¤‘ ìƒí’ˆ ì¡°íšŒ]
    E --> H[êµ¬ë§¤ ê°€ëŠ¥ ìƒí’ˆ í‘œì‹œ]
    
    H --> I{ìƒí’ˆ ì„ íƒ}
    I --> J[Redirect: /teventmain/event_buy_info]
    
    J --> K[event_buy_info Controller]
    K --> L[ê²°ì œ ì •ë³´ ì…ë ¥ í¼]
    L --> M[ê²°ì œ ë°©ë²• ì„ íƒ]
    L --> N[í¬ë§ ì‹œì‘ì¼ ì„ íƒ]
    L --> O[ë¼ì»¤ ì„ íƒ-ì„ íƒì‚¬í•­]
    
    M --> P{ê²°ì œí•˜ê¸° ë²„íŠ¼}
    P --> Q[POST: /teventmain/event_buy_proc]
    
    Q --> R[event_buy_proc Controller]
    R --> S[Pay_lib ì´ˆê¸°í™”]
    S --> T[buy_run ì‹¤í–‰]
    
    T --> U[ì‚¬ì „ ê²€ì¦]
    U --> V{ìƒí’ˆ ìœ í˜• í™•ì¸}
    
    V -->|PT| W[func_pt_yes]
    V -->|ì´ìš©ê¶Œ| X[func_pt_no]
    V -->|ë¼ì»¤í¬í•¨| Y[func_pt_no_lockr]
    V -->|ë¼ì»¤ë¯¸ì •| Z[func_pt_no_lockr_empty]
    
    W --> AA[í›„ì† ì²˜ë¦¬]
    X --> AA
    Y --> AA
    Z --> AA
    
    AA --> AB[ê¸°ì¡´ ìƒí’ˆ ì¬ë°°ì—´]
    AB --> AC[ê³„ì¢Œì…ê¸ˆ ì²˜ë¦¬]
    AC --> AD[ë¯¸ìˆ˜ê¸ˆ ì²˜ë¦¬]
    AD --> AE[êµ¬ë§¤ë‚´ì—­ ì €ì¥]
    AE --> AF[ê²°ì œê´€ë¦¬ ì €ì¥]
    AF --> AG[ë§¤ì¶œê´€ë¦¬ ì €ì¥]
    
    AG --> AH[ì™„ë£Œ ë©”ì‹œì§€]
    AH --> AI[Redirect: info_mem í˜ì´ì§€]
\`\`\`

## ì£¼ìš” ì»´í¬ë„ŒíŠ¸

### Controllers
- **Teventmain.php**: ê²°ì œ ì²˜ë¦¬ ë©”ì¸ ì»¨íŠ¸ë¡¤ëŸ¬
  - \`event_buy2()\`: ìƒí’ˆ ì„ íƒ í˜ì´ì§€
  - \`event_buy_info()\`: ê²°ì œ ì •ë³´ ì…ë ¥ í˜ì´ì§€
  - \`event_buy_proc()\`: ê²°ì œ ì²˜ë¦¬ ì‹¤í–‰

### Libraries
- **Pay_lib.php**: ê²°ì œ ì²˜ë¦¬ í•µì‹¬ ë¼ì´ë¸ŒëŸ¬ë¦¬
  - \`buy_run()\`: êµ¬ë§¤ ì‹¤í–‰
  - \`func_pt_yes()\`: PT ìƒí’ˆ ì²˜ë¦¬
  - \`func_pt_no()\`: ì´ìš©ê¶Œ ì²˜ë¦¬

### Models
- **PayModel.php**: ê²°ì œ ë°ì´í„° ê´€ë¦¬
- **EventModel.php**: ìƒí’ˆ ë°ì´í„° ê´€ë¦¬
- **MemModel.php**: íšŒì› ë°ì´í„° ê´€ë¦¬

### ì£¼ìš” í…Œì´ë¸”
- \`sales_mgmt_tbl\`: ë§¤ì¶œ ê´€ë¦¬
- \`paymt_mgmt_tbl\`: ê²°ì œ ê´€ë¦¬
- \`buy_event_mgmt_tbl\`: êµ¬ë§¤ ìƒí’ˆ ê´€ë¦¬
- \`recvb_hist_tbl\`: ë¯¸ìˆ˜ê¸ˆ ì´ë ¥`;

            renderMarkdown(paymentDoc);
        }

        function loadRefundDoc() {
            mermaidIdCounter = 0; // ID ì¹´ìš´í„° ë¦¬ì…‹
            const refundDoc = `# SpoqPlus í™˜ë¶ˆ ì‹œìŠ¤í…œ ìƒì„¸ ë¬¸ì„œ

## ëª©ì°¨
1. [ì‹œìŠ¤í…œ ê°œìš”](#ì‹œìŠ¤í…œ-ê°œìš”)
2. [í™˜ë¶ˆ í”„ë¡œì„¸ìŠ¤ í”Œë¡œìš°ì°¨íŠ¸](#í™˜ë¶ˆ-í”„ë¡œì„¸ìŠ¤-í”Œë¡œìš°ì°¨íŠ¸)
3. [ì£¼ìš” ì»´í¬ë„ŒíŠ¸](#ì£¼ìš”-ì»´í¬ë„ŒíŠ¸)

## ì‹œìŠ¤í…œ ê°œìš”

SpoqPlus í™˜ë¶ˆ ì‹œìŠ¤í…œì€ íšŒì›ì´ êµ¬ë§¤í•œ ìƒí’ˆ(ì´ìš©ê¶Œ, PT, ë¼ì»¤ ë“±)ì„ í™˜ë¶ˆ ì²˜ë¦¬í•˜ëŠ” ì¢…í•© ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

### ì£¼ìš” íŠ¹ì§•
- ì¼í•  ê³„ì‚° í™˜ë¶ˆ (ì‚¬ìš© ì¼ìˆ˜/íšŸìˆ˜ ê¸°ë°˜)
- ìœ„ì•½ê¸ˆ ë° ê¸°íƒ€ ë¹„ìš© ë³„ë„ ì²˜ë¦¬
- ì¹´ë“œ/í˜„ê¸ˆ/ê³„ì¢Œì´ì²´ í™˜ë¶ˆ ì§€ì›
- VAN ì§ì ‘ ì·¨ì†Œ ì—°ë™

## í™˜ë¶ˆ í”„ë¡œì„¸ìŠ¤ í”Œë¡œìš°ì°¨íŠ¸

ì•„ë˜ëŠ” í™˜ë¶ˆí•˜ê¸° ë²„íŠ¼ í´ë¦­ë¶€í„° í™˜ë¶ˆ ì™„ë£Œê¹Œì§€ì˜ ì „ì²´ í”„ë¡œì„¸ìŠ¤ì…ë‹ˆë‹¤:

\`\`\`mermaid
flowchart TD
    A[info_mem í˜ì´ì§€] --> B[íŒë§¤ ë¦¬ìŠ¤íŠ¸ì˜ ì„œë¸Œë©”ë‰´]
    B --> C{í™˜ë¶ˆí•˜ê¸° ë²„íŠ¼ í´ë¦­}
    C --> D[JavaScript: change_event_refund]
    D --> E[Redirect: /ttotalmain/refund_info/mem_sno/buy_sno]
    
    E --> F[refund_info Controller]
    F --> G[Refund_lib ì´ˆê¸°í™”]
    G --> H[refund_info ë©”ì†Œë“œ ì‹¤í–‰]
    H --> I[í™˜ë¶ˆ ê°€ëŠ¥ ê¸ˆì•¡ ê³„ì‚°]
    
    I --> J[í™˜ë¶ˆ ì •ë³´ í˜ì´ì§€ í‘œì‹œ]
    J --> K[ê²°ì œ ë‚´ì—­ ëª©ë¡]
    J --> L[í™˜ë¶ˆ ê¸ˆì•¡ ì •ë³´]
    J --> M[ìœ„ì•½ê¸ˆ/ê¸°íƒ€ ë¹„ìš© ì…ë ¥]
    
    K --> N{ê°œë³„ í™˜ë¶ˆ ë²„íŠ¼ í´ë¦­}
    N --> O[JavaScript: refund_cancel]
    O --> P[AJAX: /teventmain/ajax_event_buy_van_direct_cancel_proc]
    
    P --> Q[VAN ì§ì ‘ ì·¨ì†Œ ì²˜ë¦¬]
    Q --> R[van_direct_hist í…Œì´ë¸” ê¸°ë¡]
    R --> S[í™˜ë¶ˆ ê¸ˆì•¡ ì—…ë°ì´íŠ¸]
    
    M --> T{í™˜ë¶ˆí•˜ê¸° ë²„íŠ¼ í´ë¦­}
    T --> U[POST: /teventmain/refund_proc]
    
    U --> V[refund_proc Controller]
    V --> W[Refund_lib ì´ˆê¸°í™”]
    W --> X[refund_run ì‹¤í–‰]
\`\`\`

## ì£¼ìš” ì»´í¬ë„ŒíŠ¸

### Controllers
- **Ttotalmain.php**: í™˜ë¶ˆ ì •ë³´ í‘œì‹œ
  - \`refund_info()\`: í™˜ë¶ˆ ì •ë³´ í˜ì´ì§€
  
- **Teventmain.php**: í™˜ë¶ˆ ì²˜ë¦¬ ì‹¤í–‰
  - \`ajax_event_buy_van_direct_cancel_proc()\`: ê°œë³„ ê²°ì œ ì·¨ì†Œ
  - \`refund_proc()\`: ì „ì²´ í™˜ë¶ˆ ì²˜ë¦¬

### Libraries
- **Refund_lib.php**: í™˜ë¶ˆ ì²˜ë¦¬ í•µì‹¬ ë¼ì´ë¸ŒëŸ¬ë¦¬
  - \`refund_info()\`: í™˜ë¶ˆ ì •ë³´ ì¡°íšŒ
  - \`refund_run()\`: í™˜ë¶ˆ ì‹¤í–‰
  - \`func_refund_mgmt()\`: í™˜ë¶ˆ ë‚´ì—­ ì €ì¥

### Models
- **PayModel.php**: í™˜ë¶ˆ ë°ì´í„° ì €ì¥
- **EventModel.php**: ìƒí’ˆ ìƒíƒœ ì—…ë°ì´íŠ¸

### ì£¼ìš” í…Œì´ë¸”
- \`refund_mgmt_tbl\`: í™˜ë¶ˆ ê´€ë¦¬
- \`paymt_mgmt_tbl\`: ê²°ì œ ìƒíƒœ ì—…ë°ì´íŠ¸
- \`van_direct_hist\`: VAN ì·¨ì†Œ ì´ë ¥`;

            renderMarkdown(refundDoc);
        }
    </script>
</body>
</html>